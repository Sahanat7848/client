<div class="missions-page">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">Missions Explorer</h1>
            <p class="page-subtitle">Discover and join tactical operations across the Nexus</p>
        </div>
    </div>

    <mat-card class="filter-card">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>filter_alt</mat-icon>
                <span>Operational Filters</span>
            </mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div class="filter-form">
                <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search Operations</mat-label>
                    <input matInput [(ngModel)]="filter.name" placeholder="Enter mission name or ID..."
                        (keyup.enter)="onSubmit()">
                    <mat-icon matPrefix>search</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline" class="status-field">
                    <mat-label>Mission Status</mat-label>
                    <mat-select [(ngModel)]="filter.status">
                        <mat-option [value]="undefined">All Statuses</mat-option>
                        <mat-option value="Open">Open</mat-option>
                        <mat-option value="InProgress">In Progress</mat-option>
                        <mat-option value="Completed">Completed</mat-option>
                        <mat-option value="Failed">Failed</mat-option>
                    </mat-select>
                    <mat-icon matPrefix>pending_actions</mat-icon>
                </mat-form-field>

                <div class="action-buttons">
                    <button mat-raised-button color="primary" (click)="onSubmit()" class="search-btn">
                        <mat-icon>filter_list</mat-icon>
                        <span>Search</span>
                    </button>
                    <button mat-button (click)="clearFilter()" class="clear-btn">
                        <span>Reset Filters</span>
                    </button>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

    <div class="table-container mat-elevation-z8">
        @if (isLoading) {
        <div class="loading-shade">
            <mat-spinner diameter="50"></mat-spinner>
        </div>
        }

        <div class="table-viewport">
            <table mat-table [dataSource]="dataSource" matSort>

                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Designation </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="mission-name-cell">
                            <mat-icon class="mission-icon">shield</mat-icon>
                            <span>{{mission.name}}</span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef> Briefing </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="description-cell">{{mission.description}}</div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="chief_display_name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Commander </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="commander-cell">
                            <div class="avatar-sm">
                                <span class="avatar-initial">{{mission.chief_display_name[0]}}</span>
                            </div>
                            <span>{{mission.chief_display_name}}</span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="crew_count">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Strength </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="crew-badge">
                            <mat-icon>groups</mat-icon>
                            <span>{{mission.crew_count}}</span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                    <td mat-cell *matCellDef="let mission">
                        <span class="status-pill" [ngClass]="mission.status">{{mission.status}}</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="created_at">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Deployed </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="date-cell">{{mission.created_at | date:'MMM d, HH:mm'}}</div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="updated_at">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Signal </th>
                    <td mat-cell *matCellDef="let mission">
                        <div class="date-cell">{{mission.updated_at | date:'shortTime'}}</div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef> Deployment </th>
                    <td mat-cell *matCellDef="let mission">
                        @if(isSignin()){
                        <div class="action-cell">
                            <button mat-stroked-button color="primary" class="join-btn"
                                (click)="$event.stopPropagation()">
                                <mat-icon>login</mat-icon>
                                <span>Join</span>
                            </button>
                        </div>
                        }
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns();" class="mission-row"></tr>

                <!-- Row shown when there is no matching data. -->
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" [attr.colspan]="displayedColumns().length"
                        style="text-align: center; padding: 4rem; color: #6b7280;">
                        <mat-icon
                            style="font-size: 48px; width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.3;">
                            search_off
                        </mat-icon>
                        <p style="margin: 0; font-weight: 500;">No operations found matching your search criteria.</p>
                        <small>Try adjusting your filters or check back later.</small>
                    </td>
                </tr>
            </table>
        </div>

        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" aria-label="Select page of missions"></mat-paginator>
    </div>
</div>